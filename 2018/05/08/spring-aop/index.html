<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  
  
    <meta name="description" content="个人博客，活到老学到老">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    spring-aop |
    
    John</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
  <script src="/js/pace.min.js"></script>
</head>
</html>
<body>
<main class="content">
  <section class="outer">
  <article id="post-spring-aop" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      spring-aop
    </h1>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/2018/05/08/spring-aop/" class="article-date">
  <time datetime="2018-05-08T06:16:51.000Z" itemprop="datePublished">2018-05-08</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/Spring/">Spring</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h4 id="1-背景"><a href="#1-背景" class="headerlink" title="1.背景"></a>1.背景</h4><blockquote>
<p>分布于应用中多处的功能被称为<strong>横切关注点</strong>（cross-cutting concerns）。通常，这些横切关注点从概念上是于应用的业务逻辑相分离的（但是往往直接潜入到应用的业务逻辑之中）。将这些横切关注点于业务逻辑相分离正是面向切面编程（AOP）所要解决的。——《Spring实战》</p>
</blockquote>
<h4 id="2-什么是面向切面编程"><a href="#2-什么是面向切面编程" class="headerlink" title="2.什么是面向切面编程"></a>2.什么是面向切面编程</h4><p>  继承与委托是最常见的实现重用通用功能的面向对象技术。但是我们不太会在应用中使用相同的基类，而使用委托需要对委托对象进行复杂的调用。<br>  切面提供了取代继承和委托的另一种选择，在很多场景下更清晰简洁。横切关注点可以被模块化为特殊的类，这些类被称为切面。<br>  这样做有两个好处：</p>
<ol>
<li>每个关注点现在只集中于一处，而不是分散于多处代码中；</li>
<li>服务模块更简洁，因为它们只包含主要关注点（或核心功能）的代码，而次要关注点的代码被转移到切面中了。</li>
</ol>
<h4 id="3-AOP术语"><a href="#3-AOP术语" class="headerlink" title="3.AOP术语"></a>3.AOP术语</h4><p>  与大多数技术一样，AOP已经形成了自己的术语。描述切面的常用术语有<strong>通知（advice）、切点（pointcut）和连接点（join point）</strong></p>
<h5 id="3-1-通知（advice）"><a href="#3-1-通知（advice）" class="headerlink" title="3.1 通知（advice）"></a>3.1 通知（advice）</h5><p>在AOP术语中，切面的工作被称为通知。Spring切面可以应用5种类型的通知：</p>
<ul>
<li>Before——在方法被调用之前调用通知。</li>
<li>After——在方法完成之后调用通知，无论方法执行是否成功。</li>
<li>After-returning——在方法成功执行之后调用通知。</li>
<li>After-throwing——在方法抛出异常后调用通知。</li>
<li>Around——通知包裹了被通知的方法，在被通知的方法调用之前和调用之后执行自定义的行为。</li>
</ul>
<h5 id="3-2-连接点（Joinpoint）"><a href="#3-2-连接点（Joinpoint）" class="headerlink" title="3.2 连接点（Joinpoint）"></a>3.2 连接点（Joinpoint）</h5><ul>
<li>我们的应用程序可能需要对数以千计的时机应用通知，这些时机被称为连接点。</li>
<li>连接点是在应用执行过程中能够插入切面的一个点，这个点可以是调用方法时、抛出异常时、甚至修改一个字段时。切面代码可以利用这些点插入到应用的正常流程之中，并添加新的行为。</li>
</ul>
<h5 id="3-3-切点（Pointcut）"><a href="#3-3-切点（Pointcut）" class="headerlink" title="3.3 切点（Pointcut）"></a>3.3 切点（Pointcut）</h5><ul>
<li>一个切面并不需要通知应用中所有的连接点，切点有助于缩小切面所通知的连接点的范围。</li>
<li>切点的定义会匹配通知所有要织入的一个或多个连接点。</li>
<li>通常使用明确的类和方法名称来指定这些切点，或是利用正则表达式定义匹配的类和方法名称模式来指定这些切点。</li>
</ul>
<h5 id="3-4-切面（Aspect）"><a href="#3-4-切面（Aspect）" class="headerlink" title="3.4 切面（Aspect）"></a>3.4 切面（Aspect）</h5><ul>
<li>切面是通知和切点的结合。</li>
<li>通知和切点共同定义了关于切面的全部内容——它是什么，在何时完成其功能。</li>
</ul>
<h5 id="3-5-引入（Introduction）"><a href="#3-5-引入（Introduction）" class="headerlink" title="3.5 引入（Introduction）"></a>3.5 引入（Introduction）</h5><p>引入允许我们向现有的类添加新的方法或属性</p>
<h5 id="3-6-织入（Weaving）"><a href="#3-6-织入（Weaving）" class="headerlink" title="3.6 织入（Weaving）"></a>3.6 织入（Weaving）</h5><p>织入是将切面应用到目标对象来创建新的代理对象的过程。切面在指定的连接点被织入到目标对象中。在目标对象的生命周期里有多个点可以进行织入：</p>
<ol>
<li>编译期——切面在目标类编译时被织入。这种方式需要特殊的编译器。AspectJ的织入编译器就是以这种方式织入切面的。</li>
<li>类加载期——切面在目标类加载到JVM时被织入。这种方式需要特殊的类加载器（ClassLoader），它可以在目标类被引入之前增强该目标类的字节码。AspectJ 5的LTW就支持以这种方式织入切面。</li>
<li>运行期——切面在应用运行的某个时刻被织入。一般情况下，在织入切面时，AOP容器回会目标对象动态创建一个代理对象。Spring AOP就是以这种方式织入切面的。</li>
</ol>
<h4 id="4-Spring-AOP"><a href="#4-Spring-AOP" class="headerlink" title="4.Spring AOP"></a>4.Spring AOP</h4><h5 id="4-1-Spring-提供了4种各具特色的AOP支持："><a href="#4-1-Spring-提供了4种各具特色的AOP支持：" class="headerlink" title="4.1 Spring 提供了4种各具特色的AOP支持："></a>4.1 Spring 提供了4种各具特色的AOP支持：</h5><ul>
<li>基于代理的经典AOP；</li>
<li>@AspectJ 注解驱动的切面；</li>
<li>纯POJO切面；</li>
<li>注入式AspectJ切面（适合Spring各版本）</li>
</ul>
<h5 id="Spring-对AOP的支持局限于方法拦截，且只支持方法连接点（不支持字段和构造器接入点）。"><a href="#Spring-对AOP的支持局限于方法拦截，且只支持方法连接点（不支持字段和构造器接入点）。" class="headerlink" title="Spring 对AOP的支持局限于方法拦截，且只支持方法连接点（不支持字段和构造器接入点）。"></a><font color="#dd0000">Spring 对AOP的支持局限于方法拦截，且只支持方法连接点（不支持字段和构造器接入点）。</font></h5><h5 id="4-2-使用切点选择连接点"><a href="#4-2-使用切点选择连接点" class="headerlink" title="4.2 使用切点选择连接点"></a>4.2 使用切点选择连接点</h5><ul>
<li>execution指示器是编写切点定义时最主要使用的指示器。</li>
<li>execution()编写规则如：execution(<em> xxx.xxx.xxx.impl..</em>.*(..))</li>
</ul>
<h5 id="4-3-在XML中声明切面"><a href="#4-3-在XML中声明切面" class="headerlink" title="4.3 在XML中声明切面"></a>4.3 在XML中声明切面</h5><p>Spring的AOP配置元素简化了基于POJO切面的声明：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:advisor</span>&gt;</span> <span class="comment">&lt;!-- 定义AOP通知器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:after</span>&gt;</span> <span class="comment">&lt;!-- 定义AOP后置通知（不管被通知的方法是否执行成功） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:after-returning</span>&gt;</span> <span class="comment">&lt;!-- 定义AOP after-returning 通知 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:after-throwing</span>&gt;</span> <span class="comment">&lt;!-- 定义AOP after-throwing 通知 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:around</span>&gt;</span> <span class="comment">&lt;!-- 定义AOP 环绕通知 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span>&gt;</span> <span class="comment">&lt;!-- 定义切面 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-antoproxy</span>&gt;</span> <span class="comment">&lt;!-- 启用@AspectJ 注解驱动的切面 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:before</span>&gt;</span> <span class="comment">&lt;!-- 定义AOP 前置通知 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span> <span class="comment">&lt;!-- 顶层的AOP配置元素。大多数的&lt;aop:*&gt;元素必须包含在&lt;aop:config&gt;元素内 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:declare</span>&gt;</span> <span class="comment">&lt;!-- 为被通知的对象引入额外的接口，并透明地实现 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span>&gt;</span> <span class="comment">&lt;!-- 定义切点 --&gt;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="4-4-使用例子"><a href="#4-4-使用例子" class="headerlink" title="4.4 使用例子"></a>4.4 使用例子</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"xxxHandler"</span> <span class="attr">class</span>=<span class="string">"xxx.BusinessExceptionAop"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"brave"</span> <span class="attr">value</span>=<span class="string">"#&#123;brave&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"xxxHandler"</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"exceptionService"</span> <span class="attr">expression</span>=<span class="string">"execution(* xxx.impl..*.*(..))"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">pointcut-ref</span>=<span class="string">"exceptionService"</span> <span class="attr">method</span>=<span class="string">"afterThrowing"</span> <span class="attr">throwing</span>=<span class="string">"e"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://qianh.github.io/2018/05/08/spring-aop/" data-id="cjx5ugq9f0003tv34vjgpp8xp"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-aop/">Spring aop</a></li></ul>

    </footer>

  </div>

  
    
  <nav class="article-nav">
    
      <a href="/2018/05/14/java-iterator/" class="article-nav-link">
        <strong class="article-nav-caption">Newer posts</strong>
        <div class="article-nav-title">
          
            java源代码赏析 —— 迭代器（Iterator）
          
        </div>
      </a>
    
    
      <a href="/2018/05/07/spring-ioc/" class="article-nav-link">
        <strong class="article-nav-caption">Olde posts</strong>
        <div class="article-nav-title">spring-ioc</div>
      </a>
    
  </nav>


  

  
    
  

</article>



</section>
  <footer class="footer">
  
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
    <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2019 John</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>

<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/hexo.svg" alt="John"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">首页</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">归档</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">相册</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">关于</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        搜索
      </a>
    </li>
  </ul>
</nav>

<nav class="navbar navbar-bottom">
  <ul class="nav">
      <li class="nav-item">
          <div class="totop" id="totop">
    <i class="fe fe-rocket"></i>
</div>
      </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>

<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>
<script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>


  <script src="/fancybox/jquery.fancybox.min.js"></script>



  <script src="/js/search.js"></script>


<script src="/js/ocean.js"></script>

</body>
</html>